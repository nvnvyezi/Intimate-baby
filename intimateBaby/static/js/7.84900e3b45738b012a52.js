webpackJsonp([7],{"8zBs":function(t,e,a){function s(t){var e={};function a(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.i=function(t){return t},a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},a.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a.oe=function(t){throw console.error(t),t};var s=a(a.s=ENTRY_MODULE);return s.default||s}var n="[\\.|\\-|\\+|\\w|/|@]+",i="\\((/\\*.*?\\*/)?s?.*?("+n+").*?\\)";function o(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function r(t,e,s){var r={};r[s]=[];var c=e.toString(),l=c.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return r;for(var u,d=l[1],m=new RegExp("(\\\\n|\\W)"+o(d)+i,"g");u=m.exec(c);)"dll-reference"!==u[3]&&r[s].push(u[3]);for(m=new RegExp("\\("+o(d)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+i,"g");u=m.exec(c);)t[u[2]]||(r[s].push(u[1]),t[u[2]]=a(u[1]).m),r[u[2]]=r[u[2]]||[],r[u[2]].push(u[4]);for(var h,p=Object.keys(r),f=0;f<p.length;f++)for(var v=0;v<r[p[f]].length;v++)h=r[p[f]][v],isNaN(1*h)||(r[p[f]][v]=1*r[p[f]][v]);return r}function c(t){return Object.keys(t).reduce(function(e,a){return e||t[a].length>0},!1)}t.exports=function(t,e){e=e||{};var n={main:a.m},i=e.all?{main:Object.keys(n.main)}:function(t,e){for(var a={main:[e]},s={main:[]},n={main:{}};c(a);)for(var i=Object.keys(a),o=0;o<i.length;o++){var l=i[o],u=a[l].pop();if(n[l]=n[l]||{},!n[l][u]&&t[l][u]){n[l][u]=!0,s[l]=s[l]||[],s[l].push(u);for(var d=r(t,t[l][u],l),m=Object.keys(d),h=0;h<m.length;h++)a[m[h]]=a[m[h]]||[],a[m[h]]=a[m[h]].concat(d[m[h]])}}return s}(n,t),o="";Object.keys(i).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;i[t][e];)e++;i[t].push(e),n[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i[t].map(function(e){return JSON.stringify(e)+": "+n[t][e].toString()}).join(",")+"});\n"}),o=o+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i.main.map(function(t){return JSON.stringify(t)+": "+n.main[t].toString()}).join(",")+"}))(self);";var l=new window.Blob([o],{type:"text/javascript"});if(e.bare)return l;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),d=new window.Worker(u);return d.objectURL=u,d}},Cdqq:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("8zBs");var s={name:"userChangePhoto",props:{img:{type:String,default:"http://193.112.4.143/img/default.png"}},data:function(){return{flag:!0,uploadJ:!0,addBind:!0,imgg:null,originW:0,originH:0}},computed:{imgArr:function(){for(var t=[],e=1;e<=40;e++)t.push("http://193.112.4.143/img/"+e+".jpg");return t}},created:function(){this.defaultImg=this.img},methods:{movePhoto:function(t){},switchPage:function(){this.flag=!this.flag},replaceP:function(t){this.uploadJ||(document.getElementsByClassName("p-upload")[0].style.backgroundImage="url()");this.uploadJ=!0;var e=t.currentTarget.getAttribute("data-img");this.$emit("replaceP",e)},showP:function(){if(!this.uploadJ){var t=document.getElementsByClassName("p-upload")[0],e=parseInt(window.getComputedStyle(t,null).backgroundPositionX),a=parseInt(window.getComputedStyle(t,null).backgroundPositionY),s=document.createElement("canvas"),n=s.getContext("2d"),i=Math.floor(e/t.offsetWidth*this.originW),o=Math.floor(140/t.offsetWidth*this.originW),r=Math.floor(a/182*this.originH),c=Math.floor((t.offsetWidth/2-70)/t.offsetWidth*this.originW),l=Math.floor(21/182*this.originW);s.width=140,s.height=140,n.drawImage(this.imgg,-i+c,-r+l,o,o,0,0,140,140);var u=s.toDataURL("image/jpeg",.92);console.log(u),this.$emit("replaceP",u)}this.$emit("showP")},cancel:function(){this.$emit("replaceP",this.defaultImg),this.$emit("showP")},start:function(t){var e=document.getElementsByClassName("uc-photo")[0],a=document.getElementsByClassName("p-upload")[0],s=parseInt(window.getComputedStyle(a,null).backgroundPositionX),n=parseInt(window.getComputedStyle(a,null).backgroundPositionY);this.sX=s,this.sY=n,this.startX=t.targetTouches[0].clientX,this.startY=t.targetTouches[0].clientY,e.style.overflowY="hidden"},move:function(t){var e=document.getElementsByClassName("p-upload")[0],a=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY,n=a-this.startX+this.sX,i=s-this.startY+this.sY;Math.ceil(e.offsetWidth/2-70),Math.ceil(e.offsetHeight/2-70);document.getElementsByClassName("p-upload")[0].style.backgroundPosition=n+"px "+i+"px"},end:function(t){var e=document.getElementsByClassName("uc-photo")[0],a=document.getElementsByClassName("p-upload")[0];e.style.overflowY="visible";var s=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY;Math.ceil(a.offsetWidth/2-70),Math.ceil(a.offsetWidth/2+70),Math.ceil(a.offsetHeight/2-70),Math.ceil(a.offsetHeight/2+70),this.startX,this.sX,this.startY,this.sY},uplodePhoto:function(){var t=this;this.uploadJ=!1;var e=document.getElementsByClassName("b-btn")[0].files;e[0].type,e[0].name;if(window.fileReader&&window.File&&window.FileList&&window.Blob)this.$toast("你的手机不支持本地上传");else{var a=new FileReader;a.onloadstart=function(t){},a.onload=function(e){var a=document.getElementsByClassName("p-upload")[0];a.style.backgroundImage="url("+e.target.result+")",t.addBind&&(t.addBind=!1,a.addEventListener("touchstart",t.start,!1),a.addEventListener("touchmove",t.move,!1),a.addEventListener("touchend",t.end,!1));var s=t;t.imgg=new Image,t.imgg.src=e.target.result,t.imgg.onload=function(t){s.originW=this.width,s.originH=this.height},t.$toast("上传成功")},a.onerror=function(e){t.$toast("读取出错"),t.uploadJ=!0},a.onprogress=function(t){},a.readAsDataURL(e[0])}}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"uc-photo"},[a("header",{staticClass:"p-header"},[t.uploadJ?a("section",{staticClass:"p-con"},[a("img",{staticClass:"p-img",attrs:{src:t.img,alt:""}})]):a("section",{staticClass:"p-upload",on:{click:t.movePhoto}},[a("div",{staticClass:"u-cat"})]),t._v(" "),a("section",{staticClass:"h-btn"},[a("label",{staticClass:"b-style"},[t._v("上传头像\n        "),a("input",{staticClass:"b-btn",attrs:{type:"file",accept:"image/*",id:"img"},on:{change:t.uplodePhoto}})])])]),t._v(" "),a("div",{staticClass:"p-main"},[a("h3",{staticClass:"m-title"},[t._v("推荐头像")]),t._v(" "),a("section",{staticClass:"m-con"},[a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.flag,expression:"flag == true"}],staticClass:"page"},[a("ul",{staticClass:"m-ul"},t._l(t.imgArr,function(e,s){return s<20?a("li",{key:s,staticClass:"m-li",attrs:{"data-img":e},on:{click:t.replaceP}},[a("img",{staticClass:"m-icon",attrs:{src:e,alt:""}})]):t._e()}))]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0==t.flag,expression:"flag == false"}],staticClass:"page"},[a("ul",{staticClass:"m-ul"},t._l(t.imgArr,function(e,s){return s>=20?a("li",{key:s,staticClass:"m-li",attrs:{"data-img":e},on:{click:t.replaceP}},[a("img",{staticClass:"m-icon",attrs:{src:e,alt:""}})]):t._e()}))]),t._v(" "),a("footer",{staticClass:"previousPage"},[a("span",{staticClass:"pp",on:{click:t.switchPage}},[t._v(t._s(t.flag?2:1))])])])]),t._v(" "),a("div",{staticClass:"p-btn"},[a("button",{staticClass:"btn",on:{click:t.showP}},[t._v("确定")]),t._v(" "),a("button",{staticClass:"btn",on:{click:t.cancel}},[t._v("取消")])])])},staticRenderFns:[]};var i={components:{photo:a("VU/8")(s,n,!1,function(t){a("jNMF")},"data-v-786db66c",null).exports},name:"userChange",data:function(){return{userData:JSON.parse(sessionStorage.userData),day:[],pJ:!1}},computed:{year:function(){for(var t=[],e=(new Date).getFullYear(),a=e;a>=1918;a--)t.push(a);return t},month:function(){for(var t=[],e=1;e<13;e++)t.push(e);return t}},methods:{getDate:function(){var t=this,e=document.getElementById("year").value,a=document.getElementById("month").value;document.getElementById("day").value;if("年"!=e&&"月"!=a){var s=[{message:"day",func:function(t,e){return new Date(t,e,0).getDate()}}];this.$worker.create(s).postMessage("day",[e,a]).then(function(e){t.day=[];for(var a=1;a<=e;a++)t.$set(t.day,a-1,a)}).catch(function(t){console.log(t)})}},upload:function(){var t=this,e=document.getElementsByClassName("ci")[0],a=document.getElementById("nickname").value,s=document.getElementById("intro").value,n=document.getElementById("gender").value,i=document.getElementById("day").value,o=document.getElementById("month").value,r=document.getElementById("year").value,c=new FormData;if(e.src.includes("http://193.112.4.143"))e=e.src,c.append("img",e);else{var l=e.src;l=l.split(",")[1],l=window.atob(l);for(var u=new Uint8Array(l.length),d=0;d<l.length;d++)u[d]=l.charCodeAt(d);e=new Blob([u],{type:"image/png"}),c.append("img",e,this.userData.id)}var m=new XMLHttpRequest;c.append("intro",s),c.append("nickname",a),"male"!=n&&"female"!=n||c.append("gender",n),"日"!==i&&"月"!==o&&"年"!==r&&(c.append("day",i),c.append("month",o),c.append("year",r)),m.open("post","http://"+window.location.hostname+":3001/upload"),m.onreadystatechange=function(e){4==m.readyState&&200==m.status?t.$toast(JSON.parse(m.response).data):t.$toast("请求错误")},m.withCredentials=!0,m.send(c)},replaceP:function(t){this.userData.img=t},showP:function(){var t=document.getElementsByTagName("body")[0];this.pJ?t.style.overflow="visible":t.style.overflow="hidden",this.pJ=!this.pJ}},mounted:function(){this.getDate()}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-change"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.pJ,expression:"pJ"}],staticClass:"mask"}),t._v(" "),a("transition",[a("photo",{directives:[{name:"show",rawName:"v-show",value:t.pJ,expression:"pJ"}],attrs:{img:t.userData.img},on:{showP:t.showP,replaceP:t.replaceP}})],1),t._v(" "),a("div",{staticClass:"uc-con"},[t._m(0),t._v(" "),a("div",{staticClass:"c-con"},[a("section",{staticClass:"c-img"},[a("img",{staticClass:"ci",attrs:{src:t.userData.img,alt:""}}),t._v(" "),a("span",{staticClass:"c-icon",on:{click:t.showP}},[a("i",{staticClass:"i-i"})])]),t._v(" "),a("form",{staticClass:"c-form",attrs:{action:""}},[a("div",{staticClass:"cf-box"},[a("label",{staticClass:"c-label",attrs:{for:"nickname"}},[t._v("昵称")]),t._v(" "),a("input",{staticClass:"c-input",attrs:{type:"text",name:"nickname",id:"nickname",disabled:""},domProps:{value:t.userData.id}})]),t._v(" "),t._m(1),t._v(" "),a("div",{staticClass:"cf-box"},[a("label",{staticClass:"c-label",attrs:{for:"nickname"}},[t._v("简介")]),t._v(" "),a("input",{staticClass:"c-input",attrs:{type:"text",name:"intro",id:"intro"},domProps:{value:t.userData.info}})]),t._v(" "),t._m(2),t._v(" "),a("div",{staticClass:"cf-box"},[a("label",{staticClass:"c-label",attrs:{for:"nickname"}},[t._v("性别")]),t._v(" "),a("select",{staticClass:"c-sel",attrs:{name:"day",id:"day"}},[a("option",{attrs:{selected:""}},[t._v("日")]),t._v(" "),t._l(t.day,function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(t._s(e))])})],2),t._v(" "),a("select",{staticClass:"c-sel",attrs:{name:"month",id:"month"},on:{change:t.getDate}},[a("option",[t._v("月")]),t._v(" "),t._l(t.month,function(e,s){return 1===e?a("option",{key:s,attrs:{selected:""},domProps:{value:e}},[t._v(t._s(e))]):t._e()}),t._v(" "),t._l(t.month,function(e,s){return 1!==e?a("option",{key:s,domProps:{value:e}},[t._v(t._s(e))]):t._e()})],2),t._v(" "),a("select",{staticClass:"c-sel",attrs:{name:"year",id:"year"},on:{change:t.getDate}},[a("option",{attrs:{selected:""}},[t._v("年")]),t._v(" "),t._l(t.year,function(e,s){return 1998===e?a("option",{key:s,attrs:{selected:""},domProps:{value:e}},[t._v(t._s(e))]):t._e()}),t._v(" "),t._l(t.year,function(e,s){return 1998!==e?a("option",{key:s,domProps:{value:e}},[t._v(t._s(e))]):t._e()})],2)])]),t._v(" "),a("div",{staticClass:"c-btn"},[a("button",{staticClass:"f-btn",on:{click:t.upload}},[t._v("保存")])])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("header",{staticClass:"c-header"},[e("h2",{staticClass:"c-h"},[this._v("基本资料")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"cf-box"},[e("label",{staticClass:"c-label",attrs:{for:"nickname"}},[this._v("设置密码")]),this._v(" "),e("span",[this._v("设置密码")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"cf-box"},[e("label",{staticClass:"c-label",attrs:{for:"nickname"}},[this._v("性别")]),this._v(" "),e("select",{staticClass:"c-sel",attrs:{name:"gender",id:"gender"}},[e("option",{attrs:{selected:""}},[this._v("-请选择-")]),this._v(" "),e("option",{attrs:{value:"male"}},[this._v("男")]),this._v(" "),e("option",{attrs:{value:"female"}},[this._v("女")])])])}]};var r=a("VU/8")(i,o,!1,function(t){a("ZS8L")},"data-v-48e2c85d",null);e.default=r.exports},ZS8L:function(t,e){},jNMF:function(t,e){}});
//# sourceMappingURL=7.84900e3b45738b012a52.js.map