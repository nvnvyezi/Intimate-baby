webpackJsonp([17],{GiJC:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("P9l9"),s={name:"bookChapter",props:{color:{type:String,required:!0,default:"#D5EFD2"},sizeFont:{type:Number,required:!0,default:2}},data:function(){return{chapterName:"",startX:0,startY:0,flag:500,clickJudge:!1,p:0,firstCome:!0}},computed:{bookName:function(){var t=this.$store.state.bookInfo.bookName;return t||(t=localStorage.getItem("bookName")),t},authorName:function(){var t=this.$store.state.bookInfo.authorName;return t||(t=localStorage.getItem("authorName")),t}},mounted:function(){if(localStorage.historybookName!=this.bookName||localStorage.historyauthorName!=this.authorName)this.changePage(1),this.getChapter(0);else{var t=parseInt(localStorage.chapterPage);this.changePage(localStorage.chapterPage),this.getChapter(t)}},methods:{changePage:function(t){this.$store.dispatch({type:"triggerPage",page:t}),localStorage.chapterPage=t},test:function(t){if(!this.clickJudge){t.stopPropagation();try{var e=document.documentElement.offsetWidth,a=parseInt(this.$store.state.bookChapter.page),o=t.clientX;t.target===t.currentTarget.firstChild&&o<=100?(console.log("别殿了"),a>0?(this.clickJudge=!0,--a,this.changePage(a),this.getChapter(a)):(this.$emit("showWrong","当前已经是第一章"),this.changePage(0))):t.target!=t.currentTarget.firstChild&&o<=100&&(t.target.nextSibling&&t.target.nextSibling.nextSibling&&(t.target.nextSibling.nextSibling.style.display="none"),t.target.previousSibling.style.transform="translate(0px, 0px)",t.target.previousSibling.style.display="block"),t.target===t.currentTarget.lastChild&&o>=e/2+60?(console.log("别了准备下一张"),a<localStorage.getItem("chapterSize")-1?(this.clickJudge=!0,++a,this.changePage(a),this.getChapter(a)):(this.$emit("showWrong","当前已经是最后一章"),this.changePage(localStorage.getItem("chapterSize")-1))):t.target!=t.currentTarget.lastChild&&o>=e/2+60&&(t.target.previousSibling&&t.target.previousSibling.previousSibling&&(t.target.previousSibling.previousSibling.style.display="none"),t.target.style.transform="translate("+-e+"px, 0px)",t.target.nextSibling.style.display="block")}catch(t){console.log(t),this.$emit("showWrong","获取出错,请刷新一下")}}},getChapter:function(t){var e=this;document.getElementsByClassName("chapter")[0].innerHTML='<div class="chapter--content" style="position: absolute;width: 95vw;left: 50%;margin-left: -47.5vw;ransition: transform .5s ease;"></div>',this.firstCome?(this.firstCome=!1,this.$emit("showWrong","第一次加载缓慢")):this.$emit("showWrong","正在获取"),Object(o.j)(this.bookName,this.authorName,t,function(t){t.err?e.$emit("showWrong",t.data):(e.clickJudge=!1,e.handleText(t.text),e.$emit("reduction"))})},handleText:function(t){var e=document.getElementsByClassName("chapter")[0],a=document.getElementsByClassName("chapter--content")[0],o=document.createElement("div"),s=document.documentElement.offsetHeight||document.body.offsetHeight;a.style.zIndex=this.flag,a.style.backgroundColor="#"+this.color,this.flag--,e.appendChild(o);for(var r=0,i=t.length;r<i;r++){if(o.innerHTML=t.substring(0,r),!(o.offsetHeight<=s-50)){e.removeChild(o),this.handleTextOver(t,r-1,i,s);break}a.innerHTML=t.substring(0,r),r==i-1&&e.removeChild(o)}},handleTextOver:function(t,e,a,o){var s=document.createElement("div"),r=document.getElementsByClassName("chapter")[0];s.setAttribute("data-flag",this.flag),s.style.zIndex=this.flag,s.style.position="absolute",s.style.width="95vw",s.style.left="50%",s.style.marginLeft="-47.5vw",s.style.backgroundColor="#"+this.color,s.style.transition="transform .5s ease",s.className="chapter--content",this.flag--,r.appendChild(s);for(var i=e;i<a;i++){if(s.innerHTML=t.substring(e,i),!(s.offsetHeight<=o-10)){s.innerHTML=t.substring(e,i-1),s.style.height=o+"px",this.handleTextOver(t,i-1,a,o);break}i==a-1&&(s.style.height=o+"px")}}},watch:{color:function(t){var e=document.getElementsByClassName("chapter"),a=document.getElementsByClassName("chapter--content");e[0].style.backgroundColor="#"+this.color;for(var o=0;o<a.length;o++)a[o].style.backgroundColor="#"+this.color}},beforeDestroy:function(){localStorage.setItem("historybookName",this.bookName),localStorage.setItem("historyauthorName",this.authorName)}},r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"chapterBox",style:{fontSize:this.sizeFont+"rem"}},[e("h3",{staticClass:"h3"},[this._v(this._s(this.chapterName))]),this._v(" "),e("div",{staticClass:"chapter",on:{click:this.test}})])},staticRenderFns:[]};var i=a("VU/8")(s,r,!1,function(t){a("cJsq")},"data-v-27b77297",null);e.default=i.exports},cJsq:function(t,e){}});
//# sourceMappingURL=17.f982fac535c3b36f913d.js.map